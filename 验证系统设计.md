# ç”¨æˆ·éªŒè¯å’Œç»Ÿè®¡ç³»ç»Ÿè®¾è®¡

## ğŸ¯ ç›®æ ‡
- ç»Ÿè®¡ä½¿ç”¨äººæ•°
- éªŒè¯ç”¨æˆ·ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- **ä¸ä¿å­˜**å­¦å·ã€å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯
- æˆæœ¬æ§åˆ¶åœ¨10å…ƒ/æœˆ

---

## ğŸ—ï¸ æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šè®¾å¤‡æŒ‡çº¹ + ç®€å•éªŒè¯

```
é¦–æ¬¡ä½¿ç”¨ï¼š
1. ç”¨æˆ·æ‰“å¼€è½¯ä»¶
2. ç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼ˆæœºå™¨å”¯ä¸€IDï¼‰
3. å‘é€åˆ°æœåŠ¡å™¨æ³¨å†Œ
4. æœåŠ¡å™¨è¿”å›ï¼šå…è®¸ä½¿ç”¨

å†æ¬¡ä½¿ç”¨ï¼š
1. è¯»å–æœ¬åœ°è®¾å¤‡æŒ‡çº¹
2. å‘é€åˆ°æœåŠ¡å™¨éªŒè¯
3. æœåŠ¡å™¨æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
4. è¿”å›ï¼šå…è®¸/æ‹’ç»
```

---

## ğŸ’» å®¢æˆ·ç«¯å®ç°

### ç”Ÿæˆè®¾å¤‡æŒ‡çº¹

```powershell
function Get-DeviceFingerprint {
    # è·å–å¤šä¸ªç¡¬ä»¶ä¿¡æ¯ç»„åˆ
    $cpu = (Get-WmiObject Win32_Processor).ProcessorId
    $board = (Get-WmiObject Win32_BaseBoard).SerialNumber
    $disk = (Get-WmiObject Win32_DiskDrive | Select-Object -First 1).SerialNumber
    
    $combined = "$cpu-$board-$disk"
    
    # ç”Ÿæˆå“ˆå¸Œ
    $bytes = [System.Text.Encoding]::UTF8.GetBytes($combined)
    $hash = [System.Security.Cryptography.SHA256]::Create().ComputeHash($bytes)
    $fingerprint = [BitConverter]::ToString($hash).Replace('-','').Substring(0,32)
    
    return $fingerprint
}

function Register-Device {
    param(
        [string]$SchoolId
    )
    
    $fingerprint = Get-DeviceFingerprint
    
    # å‘é€åˆ°æœåŠ¡å™¨
    $body = @{
        device_id = $fingerprint
        school_id = $SchoolId
        os_version = [System.Environment]::OSVersion.VersionString
        timestamp = (Get-Date).ToString('o')
    } | ConvertTo-Json
    
    try {
        $response = Invoke-RestMethod `
            -Uri "https://your-server.com/api/register" `
            -Method POST `
            -Body $body `
            -ContentType "application/json" `
            -TimeoutSec 5
        
        if ($response.success) {
            # ä¿å­˜æ¿€æ´»ä¿¡æ¯
            $activation = @{
                device_id = $fingerprint
                school_id = $SchoolId
                activated_at = Get-Date
            } | ConvertTo-Json
            
            $stableDir = Join-Path $env:APPDATA 'CampusNet'
            $activation | Out-File (Join-Path $stableDir 'activation.json') -Encoding UTF8
            
            return $true
        }
    } catch {
        # ç½‘ç»œé”™è¯¯æ—¶ï¼Œå…è®¸ç¦»çº¿ä½¿ç”¨ï¼ˆå®½æ¾ç­–ç•¥ï¼‰
        Write-Host "ç½‘ç»œéªŒè¯å¤±è´¥ï¼Œå…è®¸ç¦»çº¿ä½¿ç”¨"
        return $true
    }
    
    return $false
}

function Verify-Device {
    $activationFile = Join-Path $env:APPDATA 'CampusNet\activation.json'
    
    if (-not (Test-Path $activationFile)) {
        return $false
    }
    
    $activation = Get-Content $activationFile | ConvertFrom-Json
    $currentFingerprint = Get-DeviceFingerprint
    
    # æœ¬åœ°éªŒè¯
    if ($activation.device_id -eq $currentFingerprint) {
        
        # å®šæœŸåœ¨çº¿éªŒè¯ï¼ˆ7å¤©ä¸€æ¬¡ï¼‰
        if ((Get-Date) - [DateTime]$activation.activated_at -gt [TimeSpan]::FromDays(7)) {
            # å‘é€å¿ƒè·³åˆ°æœåŠ¡å™¨
            try {
                Invoke-RestMethod `
                    -Uri "https://your-server.com/api/heartbeat" `
                    -Method POST `
                    -Body (@{device_id=$currentFingerprint} | ConvertTo-Json) `
                    -ContentType "application/json" `
                    -TimeoutSec 5
            } catch {
                # ç½‘ç»œé”™è¯¯ï¼Œå¿½ç•¥
            }
        }
        
        return $true
    }
    
    return $false
}
```

---

## ğŸ–¥ï¸ æœåŠ¡å™¨å®ç°ï¼ˆNode.jsï¼‰

### æç®€APIï¼ˆ10å…ƒæœåŠ¡å™¨èƒ½è·‘ï¼‰

```javascript
// server.js
const express = require('express');
const fs = require('fs');
const app = express();

app.use(express.json());

// ç®€å•çš„æ–‡ä»¶å­˜å‚¨ï¼ˆåæœŸå¯ä»¥æ¢æ•°æ®åº“ï¼‰
const DATA_FILE = './devices.json';

// åŠ è½½æ•°æ®
let devices = [];
if (fs.existsSync(DATA_FILE)) {
    devices = JSON.parse(fs.readFileSync(DATA_FILE, 'utf8'));
}

// ä¿å­˜æ•°æ®
function saveDevices() {
    fs.writeFileSync(DATA_FILE, JSON.stringify(devices, null, 2));
}

// æ³¨å†Œè®¾å¤‡
app.post('/api/register', (req, res) => {
    const { device_id, school_id, os_version } = req.body;
    
    // æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
    const existing = devices.find(d => d.device_id === device_id);
    
    if (existing) {
        existing.last_active = new Date();
        saveDevices();
        return res.json({ success: true, message: 'è®¾å¤‡å·²æ³¨å†Œ' });
    }
    
    // æ–°è®¾å¤‡
    devices.push({
        device_id,
        school_id,
        os_version,
        registered_at: new Date(),
        last_active: new Date()
    });
    
    saveDevices();
    
    console.log(`æ–°è®¾å¤‡æ³¨å†Œï¼š${school_id} - æ€»æ•°ï¼š${devices.length}`);
    
    res.json({ success: true, message: 'æ³¨å†ŒæˆåŠŸ' });
});

// å¿ƒè·³ï¼ˆæ›´æ–°æ´»è·ƒæ—¶é—´ï¼‰
app.post('/api/heartbeat', (req, res) => {
    const { device_id } = req.body;
    
    const device = devices.find(d => d.device_id === device_id);
    
    if (device) {
        device.last_active = new Date();
        saveDevices();
    }
    
    res.json({ success: true });
});

// ç»Ÿè®¡ä¿¡æ¯ï¼ˆä¾›ä½ æŸ¥çœ‹ï¼‰
app.get('/api/stats', (req, res) => {
    const stats = {
        total_devices: devices.length,
        by_school: {}
    };
    
    devices.forEach(d => {
        if (!stats.by_school[d.school_id]) {
            stats.by_school[d.school_id] = 0;
        }
        stats.by_school[d.school_id]++;
    });
    
    res.json(stats);
});

app.listen(3000, () => {
    console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 3000');
});
```

### éƒ¨ç½²åˆ°10å…ƒæœåŠ¡å™¨

```bash
# 1. å®‰è£…Node.js
curl -fsSL https://rpm.nodesource.com/setup_16.x | sudo bash -
sudo yum install -y nodejs

# 2. åˆ›å»ºé¡¹ç›®
mkdir xiaoci-server && cd xiaoci-server
npm init -y
npm install express

# 3. ä¸Šä¼  server.js

# 4. ä½¿ç”¨PM2è¿è¡Œï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm install -g pm2
pm2 start server.js
pm2 save
pm2 startup

# 5. é…ç½®Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
# è®©ä½ çš„åŸŸåæŒ‡å‘è¿™ä¸ªAPI
```

---

## ğŸ“Š ç»Ÿè®¡æŸ¥çœ‹

### è®¿é—®ç»Ÿè®¡
```
http://your-server.com/api/stats

è¿”å›ç¤ºä¾‹ï¼š
{
  "total_devices": 156,
  "by_school": {
    "jci": 89,
    "jingdezhen_ceramic": 45,
    "jingdezhen_college": 22
  }
}
```

---

## ğŸ’° æˆæœ¬åˆ†æ

### 10å…ƒ/æœˆæœåŠ¡å™¨èƒ½æ”¯æ’‘ï¼š
- âœ… 10,000+ æ³¨å†Œè®¾å¤‡
- âœ… 100,000+ APIè¯·æ±‚/æœˆ
- âœ… ç®€å•çš„æ–‡ä»¶å­˜å‚¨ï¼ˆdevices.jsonï¼‰

### æ‰©å±•æ–¹æ¡ˆï¼ˆå¦‚æœç”¨æˆ·é‡å¤§ï¼‰ï¼š
- æ”¹ç”¨SQLiteï¼ˆå…è´¹ï¼‰
- æˆ–ä½¿ç”¨äº‘æ•°æ®åº“ï¼ˆçº¦50å…ƒ/æœˆï¼‰

---

## ğŸ”’ éšç§ä¿æŠ¤

### æˆ‘ä»¬æ”¶é›†ä»€ä¹ˆï¼š
âœ… è®¾å¤‡æŒ‡çº¹ï¼ˆæ— æ³•åæ¨ä¸ªäººä¿¡æ¯ï¼‰
âœ… å­¦æ ¡ID
âœ… æ“ä½œç³»ç»Ÿç‰ˆæœ¬
âœ… æ³¨å†Œæ—¶é—´

### æˆ‘ä»¬ä¸æ”¶é›†ï¼š
âŒ å­¦å·
âŒ å¯†ç 
âŒ å§“å
âŒ æ‰‹æœºå·
âŒ IPåœ°å€ï¼ˆå¯é€‰ï¼‰

